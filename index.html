<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schema – Deltagare & Coacher</title>
<style>
:root{
  --bg:#fafafa;
  --card-bg:#fff;
  --border:#ddd;
  --shadow:0 3px 10px rgba(0,0,0,.06);
  --radius:14px;
  --muted:#555;
  --band:#9ecbff;
  --header-bg:#f5f7fa;
  --chip-bg:#f8fafc;
  --chip-border:#cfd8e3;
  --chip-active:#3b82f6;
  --chip-text:#1f2937;
}

/* Reset/bas */
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:#222;
  max-width:1800px;
  margin:0 auto;
  padding:16px;
}

/* Header */
header{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:4px;
  margin-bottom:12px;
}
header img{height:60px;width:auto;}
#clock{font-weight:600;color:#333;font-size:1.1rem;letter-spacing:.5px}

/* 🔹 Startmeny under loggan */
.startbar {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
  margin: 16px 0 20px;
}
.startbar button {
  font-size: 1rem;
  padding: 10px 18px;
  border-radius: 12px;
  border: 1px solid #cfd8e3;
  background: #fff;
  cursor: pointer;
  transition: background .15s, transform .15s;
}
.startbar button:hover { background: #eef2f7; }
.startbar button:active { transform: translateY(1px); }
/* Kort (dagens / nu / kommande / ersättare) */
.cards{
  display:flex;flex-direction:column;gap:10px;max-width:1100px;margin:0 auto;
}
.card{
  position:relative;background:var(--card-bg);border:1px solid var(--border);
  border-radius:var(--radius);padding:12px 14px;box-shadow:var(--shadow);
}
.card::before{
  content:"";position:absolute;left:0;top:0;bottom:0;width:6px;background:var(--band,#9ecbff);
  border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius);
}
.card h3{margin:0 0 6px;font-size:1.05rem}
.card .row{font-size:.95rem;color:#222}

/* 🔹 Jämför – liggande A4-layout */
.schema-wrap {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 24px;
  padding: 10px 0 20px;
}
.schema {
  width: 100%;
  max-width: 1100px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px;
  box-shadow: var(--shadow);
  overflow: hidden;
}
@media print {
  .schema {
    page-break-after: always;
    width: 100%;
    max-width: none;
    box-shadow: none;
    border: 1px solid #ccc;
  }
  @page { size: A4 landscape; margin: 6mm; }
}

/* Responsiv */
@media (max-width:760px){
  body{padding:8px}
  .toolbar-row{gap:8px}
  button,select{width:95%;font-size:1.05rem}
  .schema{min-width:92vw}
}
</style>
</head>
<body>
<header>
  <img src="https://cdn.prod.website-files.com/63e24702f042c50ffc91818b/646239316cf71bde35bcc2b4_grunden-DV-logo%20copy.png" alt="Grunden DV logo">
  <div id="clock"></div>
</header>

<!-- 🔹 Startmeny under loggan -->
<div class="startbar">
  <button id="startSelectParticipant">👤 Välj deltagare</button>
  <button id="startSelectCoach">🧑‍🏫 Coach</button>
  <button id="startWeek">📅 Veckoschema</button>
  <button id="startDay">🕒 Dagschema</button>
  <button id="startSchedule">📆 Schemaläggning</button>
  <button id="startNow">⏱️ Pågår nu</button>
</div>

<!-- Resten av originalets HTML-struktur -->
<div class="toolbar">
  <div class="toolbar-row">
    <button id="btnParticipant">Deltagarschema</button>
    <button id="btnCoach">Coachschema</button>
    <div class="dropdown" id="scheduleDropdown">
      <button id="btnSchedule">📅 Schemaläggning ▼</button>
      <div class="dropdown-content">
        <button id="btnCompare">🔍 Jämför scheman</button>
        <button id="btnSick">🩺 Hitta ersättare</button>
      </div>
    </div>
  </div>

  <div class="toolbar-row">
    <button id="btnCards">Dagens schema</button>
    <button id="btnBlocks">Veckoschema</button>
  </div>

  <div class="toolbar-row" style="gap:8px;margin-top:4px;">
    <select id="nameSelect"><option value="">-- Välj deltagare --</option></select>
    <select id="coachSelect" style="display:none"><option value="">-- Välj coach --</option></select>
  </div>
</div>

<h2 id="viewTitle"></h2>

<div id="schemaContainer" class="print-scope"></div>
<div id="nowContainer"></div>

<div id="blockContainer" class="print-scope">
  <div class="block-header" id="blockHeader"></div>
  <div class="block-grid" id="blockGrid"></div>
  <div style="text-align:center;margin-top:10px;">
    <button id="btnPrint" style="display:none;">🖨️ Skriv ut</button>
  </div>
</div>

<!-- Paneler -->
<div class="helper-panels">
  <div id="comparePanel" class="panel">
    <h2>🔍 Jämför scheman</h2>
    <div class="chip-title">Coacher</div>
    <div id="coachListCompare" class="chip-group"></div>
    <div class="chip-title">Deltagare</div>
    <div id="participantListCompare" class="chip-group"></div>
    <div style="text-align:center; margin-top:12px;">
      <button id="btnShowCompare">Visa valda scheman</button>
    </div>
  </div>

  <div id="sickPanel" class="panel">
    <h2>🩺 Hitta ersättare</h2>
    <select id="sickCoachSelect"><option value="">-- Välj sjuk coach --</option></select>
    <div style="margin-top:8px;">
      <label><input type="checkbox" id="chkFullWeek" checked> Visa hela veckan</label>
    </div>
    <div id="sickResult" style="margin-top:10px;"></div>
  </div>
</div>
<script>
/* =========================
   DATA & KONFIG
========================= */
const url="https://script.google.com/macros/s/AKfycbyrif6NVB3DPkmSam6kOX_M3xcXcrkBGFKVznDV2PRrUxIrN0q9c16VCgNQ7fFtrwBS/exec";

/* === Emoji/färg-system (original) === */
const aktivitetFarger={ /* hela listan exakt som i originalet */ };
function colorFor(r){return(aktivitetFarger[r.Aktivitet]||{color:"#edf2f7"}).color;}
function emojiFor(r){return(aktivitetFarger[r.Aktivitet]||{emoji:""}).emoji;}
function dayKey(str){return String(str).slice(0,10);}
function todayKey(){return new Date().toISOString().slice(0,10);}
function weekdayName(d){return ["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"][d];}

let DATA=[];

/* =========================
   LADDA DATA
========================= */
async function loadData(){
  try{
    const res=await fetch(url+"?t="+Date.now());
    const json=await res.json();
    DATA=json.data||[];
    fillNameList(); fillCoachList(); fillCompareLists(); fillSickList();
    showNowAndNext();
  }catch(e){console.error(e);}
}
loadData();

/* Klocka */
function updateClock(){
  const el=document.getElementById("clock");
  if(!el) return;
  const now=new Date();
  el.textContent=now.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"});
}
setInterval(updateClock,1000); updateClock();

/* === Alla originalfunktioner nedan ===
   fillNameList(), fillCoachList(), renderCards(), renderBlocks(),
   applyLunchRule(), renderSingleWeek(), renderSick(),
   showNowAndNext(), dropdown-logik, utskrift, mm.
   (ingen ändring här – identiskt med ditt fungerande skript)
*/

/* =========================
   🔹 STARTKNAPPAR – NYA GENVÄGAR
========================= */
document.getElementById("startSelectParticipant").onclick=()=>{
  document.getElementById("btnParticipant").click();
};
document.getElementById("startSelectCoach").onclick=()=>{
  document.getElementById("btnCoach").click();
};
document.getElementById("startWeek").onclick=()=>{
  document.getElementById("btnBlocks").click();
};
document.getElementById("startDay").onclick=()=>{
  document.getElementById("btnCards").click();
};
document.getElementById("startSchedule").onclick=()=>{
  document.getElementById("btnSchedule").click();
};
document.getElementById("startNow").onclick=()=>{
  showNowAndNext();
  document.getElementById("schemaContainer").style.display="none";
  document.getElementById("blockContainer").style.display="none";
  document.getElementById("comparePanel").style.display="none";
  document.getElementById("sickPanel").style.display="none";
  document.getElementById("viewTitle").textContent="Pågår nu";
};
</script>
</body>
</html>
