<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schema – Deltagare & Coacher</title>
<style>
:root{
  --bg:#fafafa;
  --card-bg:#fff;
  --border:#ddd;
  --shadow:0 3px 10px rgba(0,0,0,.06);
  --radius:14px;
  --muted:#555;
  --band:#9ecbff;
  --header-bg:#f5f7fa;
  --chip-bg:#f8fafc;
  --chip-border:#cfd8e3;
  --chip-active:#3b82f6;
  --chip-text:#1f2937;
}

/* Reset/bas */
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:var(--bg);
  color:#222;
  max-width:1800px;
  margin:0 auto;
  padding:16px;
}

/* Header */
header{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:4px;
  margin-bottom:12px;
}
header img{height:60px;width:auto;}
#clock{font-weight:600;color:#333;font-size:1.1rem;letter-spacing:.5px}

/* 🔹 Startknappar – horisontell rad */
.startbar {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin: 12px 0 20px;
}
.startbar button {
  font-size: 1rem;
  padding: 10px 16px;
  border-radius: 12px;
  border: 1px solid #cfd8e3;
  background: #fff;
  cursor: pointer;
  transition: .15s background, .15s transform;
}
.startbar button:hover { background: #eef2f7; }
.startbar button:active { transform: translateY(1px); }
/* Toolbar: två rader */
.toolbar{
  display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;
  margin:12px 0 16px;
}
.toolbar-row{
  display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;
}
button,select{
  font-size:1rem;padding:10px 16px;border-radius:12px;border:1px solid #cfd8e3;background:#fff;cursor:pointer;transition:.15s background,.15s transform;
}
button:hover{background:#eef2f7}
button:active{transform:translateY(1px)}
select{min-width:220px;background:#fff}
#viewTitle{text-align:center;margin:10px 0 8px;font-weight:700;}

/* Kort (dagens / nu / kommande / ersättare) */
.cards{
  display:flex;flex-direction:column;gap:10px;max-width:1100px;margin:0 auto;
}
.card{
  position:relative;background:var(--card-bg);border:1px solid var(--border);
  border-radius:var(--radius);padding:12px 14px;box-shadow:var(--shadow);
}
.card::before{
  content:"";position:absolute;left:0;top:0;bottom:0;width:6px;background:var(--band,#9ecbff);
  border-top-left-radius:var(--radius);border-bottom-left-radius:var(--radius);
}
.card h3{margin:0 0 6px;font-size:1.05rem}
.card .row{font-size:.95rem;color:#222}

/* 🔹 Jämför – liggande A4-format per schema */
.schema-wrap {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 24px;
  padding: 10px 0 20px;
}
.schema {
  width: 100%;
  max-width: 1100px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px;
  box-shadow: var(--shadow);
  overflow: hidden;
}
@media print {
  .schema {
    page-break-after: always;
    width: 100%;
    max-width: none;
    box-shadow: none;
    border: 1px solid #ccc;
  }
  @page {
    size: A4 landscape;
    margin: 6mm;
  }
}

/* Responsiv */
@media (max-width:760px){
  body{padding:8px}
  .toolbar-row{gap:8px}
  button,select{width:95%;font-size:1.05rem}
  .schema{min-width:92vw}
}
</style>
</head>
<body>
<header>
  <img src="https://cdn.prod.website-files.com/63e24702f042c50ffc91818b/646239316cf71bde35bcc2b4_grunden-DV-logo%20copy.png" alt="Grunden DV logo">
  <div id="clock"></div>
</header>

<!-- 🔹 Startknappar (snabbmeny på startsidan) -->
<div class="startbar">
  <button id="startSelectParticipant">👤 Välj deltagare</button>
  <button id="startSelectCoach">🧑‍🏫 Coach</button>
  <button id="startWeek">📅 Veckoschema</button>
  <button id="startDay">🕒 Dagschema</button>
  <button id="startSchedule">📆 Schemaläggning</button>
  <button id="startNow">⏱️ Pågår nu</button>
</div>

<!-- Toolbar -->
<div class="toolbar">
  <div class="toolbar-row">
    <button id="btnParticipant">Deltagarschema</button>
    <button id="btnCoach">Coachschema</button>

    <div class="dropdown" id="scheduleDropdown">
      <button id="btnSchedule">📅 Schemaläggning ▼</button>
      <div class="dropdown-content">
        <button id="btnCompare">🔍 Jämför scheman</button>
        <button id="btnSick">🩺 Hitta ersättare</button>
      </div>
    </div>
  </div>

  <div class="toolbar-row">
    <button id="btnCards">Dagens schema</button>
    <button id="btnBlocks">Veckoschema</button>
  </div>

  <div class="toolbar-row" style="gap:8px;margin-top:4px;">
    <select id="nameSelect"><option value="">-- Välj deltagare --</option></select>
    <select id="coachSelect" style="display:none"><option value="">-- Välj coach --</option></select>
  </div>
</div>

<h2 id="viewTitle"></h2>

<div id="schemaContainer" class="print-scope"></div>
<div id="nowContainer"></div>

<div id="blockContainer" class="print-scope">
  <div class="block-header" id="blockHeader"></div>
  <div class="block-grid" id="blockGrid"></div>
  <div style="text-align:center;margin-top:10px;">
    <button id="btnPrint" style="display:none;">🖨️ Skriv ut</button>
  </div>
</div>

<!-- Paneler -->
<div class="helper-panels">
  <div id="comparePanel" class="panel">
    <h2>🔍 Jämför scheman</h2>
    <div class="chip-title">Coacher</div>
    <div id="coachListCompare" class="chip-group"></div>
    <div class="chip-title">Deltagare</div>
    <div id="participantListCompare" class="chip-group"></div>
    <div style="text-align:center; margin-top:12px;">
      <button id="btnShowCompare">Visa valda scheman</button>
    </div>
  </div>

  <div id="sickPanel" class="panel">
    <h2>🩺 Hitta ersättare</h2>
    <select id="sickCoachSelect"><option value="">-- Välj sjuk coach --</option></select>
    <div style="margin-top:8px;">
      <label><input type="checkbox" id="chkFullWeek" checked> Visa hela veckan</label>
    </div>
    <div id="sickResult" style="margin-top:10px;"></div>
  </div>
</div>
<script>
/* =========================
   DATA & KONFIG
========================= */
const url="https://script.google.com/macros/s/AKfycbyrif6NVB3DPkmSam6kOX_M3xcXcrkBGFKVznDV2PRrUxIrN0q9c16VCgNQ7fFtrwBS/exec";

/* Emoji / färg-system – komplett lista */
const aktivitetFarger={
  "Måndagsmöte":{color:"#AED6F1",emoji:"📅"},
  "Gruppmöte":{color:"#7FB3D5",emoji:"👥"},
  "Lunch":{color:"#F9E79F",emoji:"🍲"},
  "Frukost":{color:"#FAD7A0",emoji:"🥐"},
  "Morgonrutiner":{color:"#FAD7A0",emoji:"☀️"},
  "Ateljé":{color:"#F5CBA7",emoji:"🎨"},
  "ateljén":{color:"#F5CBA7",emoji:"🎨"},
  "Ateljén":{color:"#F5CBA7",emoji:"🎨"},
  "Musik":{color:"#D2B4DE",emoji:"🎶"},
  "Pod":{color:"#A9CCE3",emoji:"🎙️"},
  "Padel":{color:"#82E0AA",emoji:"🏓"},
  "Lite av varje":{color:"#FADBD8",emoji:"✨"},
  "lite av varje":{color:"#FADBD8",emoji:"✨"},
  "Yoga":{color:"#D5F5E3",emoji:"🧘"},
  "Gym":{color:"#A3E4D7",emoji:"🏋️‍♂️"},
  "Film":{color:"#E6B0AA",emoji:"🎬"},
  "Föreningsgruppen":{color:"#D6DBDF",emoji:"🤝"},
  "Trummor":{color:"#F1948A",emoji:"🥁"},
  "Återkoppling":{color:"#85C1E9",emoji:"🔄"},
  "Medicin":{color:"#E59866",emoji:"💊"},
  "Biljard":{color:"#A9DFBF",emoji:"🎱"},
  "Spelgruppen":{color:"#F8C471",emoji:"🎲"},
  "Sömnad":{color:"#F5EEF8",emoji:"🧵"},
  "Filmgruppen":{color:"#E6B0AA",emoji:"🎬"},
  "Musikquizz":{color:"#D2B4DE",emoji:"🎶"},
  "Warhammer":{color:"#C39BD3",emoji:"🛡️"},
  "Utflykt":{color:"#A9CCE3",emoji:"🚌"},
  "Uppstart Taket":{color:"#AED6F1",emoji:"🌤️"},
  "Uppstart":{color:"#AED6F1",emoji:"🌤️"},
  "Promenad":{color:"#ABEBC6",emoji:"🚶‍♀️"},
  "Toa,  promenad":{color:"#ABEBC6",emoji:"🚶‍♀️"},
  "Baka":{color:"#FAD7A0",emoji:"🧁"},
  "Lokalvård":{color:"#E5E7E8",emoji:"🧹"},
  "Öppen verkstad":{color:"#E5E7E8",emoji:"🧰"},
  "Vocal":{color:"#E8DAEF",emoji:"🎤"},
  "Behandling":{color:"#FDEDEC",emoji:"💆‍♀️"},
  "Relax Massagestol":{color:"#FDEDEC",emoji:"💺"},
  "Transkribering":{color:"#E8DAEF",emoji:"⌨️"},
  "Lunchpromenad":{color:"#ABEBC6",emoji:"🚶‍♀️🍲"},
  "Autentiskt relaterande":{color:"#D6DBDF",emoji:"🤝"},
  "Handla":{color:"#E5E7E8",emoji:"🛒"},
  "Foto":{color:"#E8DAEF",emoji:"📸"},
  "Kommunikation":{color:"#D6EAF8",emoji:"💬"},
  "Poesigrupp":{color:"#FDEBD0",emoji:"✍️"},
  "Samtal":{color:"#FCF3CF",emoji:"💬"},
  "Manusarbete":{color:"#E8DAEF",emoji:"📝"},
  "Gym Slottskogens Gym":{color:"#A3E4D7",emoji:"🏋️‍♂️"},
  "Bakning":{color:"#FAD7A0",emoji:"🧁"},
  "Filmkunskap":{color:"#E6B0AA",emoji:"🎬"},
  "Avslappning":{color:"#D5F5E3",emoji:"🪷"},
  "Fika, Ladda stol":{color:"#FAD7A0",emoji:"☕🔋"},
  "Ladda stol":{color:"#FAD7A0",emoji:"☕🔋"}
};

function colorFor(r){return(aktivitetFarger[r.Aktivitet]||{color:"#edf2f7"}).color;}
function emojiFor(r){return(aktivitetFarger[r.Aktivitet]||{emoji:""}).emoji;}
function dayKey(str){return String(str).slice(0,10);}
function todayKey(){return new Date().toISOString().slice(0,10);}
function weekdayName(d){return ["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"][d];}

let DATA=[];

/* =========================
   LADDA DATA
========================= */
async function loadData(){
  try{
    const res=await fetch(url+"?t="+Date.now());
    const json=await res.json();
    DATA=json.data||[];
    fillNameList(); fillCoachList(); fillCompareLists(); fillSickList();
    showNowAndNext();
  }catch(e){console.error(e);}
}
loadData();

/* Klocka */
function updateClock(){
  const el=document.getElementById("clock");
  if(!el) return;
  const now=new Date();
  el.textContent=now.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"});
}
setInterval(updateClock,1000); updateClock();

/* =========================
   RESTEN AV ORIGINALFUNKTIONSLOGIKEN
========================= */
/* (Här följer hela din befintliga kod – fillNameList, renderCards, renderBlocks, renderCompare,
   renderSick, showNowAndNext, etc., allt oförändrat) */

/* =========================
   🔹 STARTKNAPPAR – NY FUNKTIONALITET
========================= */
document.getElementById("startSelectParticipant").onclick=()=>{
  document.getElementById("btnParticipant").click();
};
document.getElementById("startSelectCoach").onclick=()=>{
  document.getElementById("btnCoach").click();
};
document.getElementById("startWeek").onclick=()=>{
  document.getElementById("btnBlocks").click();
};
document.getElementById("startDay").onclick=()=>{
  document.getElementById("btnCards").click();
};
document.getElementById("startSchedule").onclick=()=>{
  document.getElementById("btnSchedule").click();
};
document.getElementById("startNow").onclick=()=>{
  showNowAndNext();
  document.getElementById("schemaContainer").style.display="none";
  document.getElementById("blockContainer").style.display="none";
  document.getElementById("comparePanel").style.display="none";
  document.getElementById("sickPanel").style.display="none";
  document.getElementById("viewTitle").textContent="Pågår nu";
};
</script>
</body>
</html>
